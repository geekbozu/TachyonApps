services:
  surrealdb:
    image: surrealdb/surrealdb:v2
    command: start --username $${SURREAL_USER} --password $${SURREAL_PASSWORD} --bind 0.0.0.0:8000 rocksdb:/mydata/mydatabase.db
    env_file:
      - /mnt/sdcard/open-notebook/.env
    ports:
      - "8000:8000"
    volumes:
      - /mnt/sdcard/open-notebook/surreal_data:/mydata
    networks:
      - proxy-network
    depends_on:
      sdcard-mount:
        condition: service_healthy
    restart: unless-stopped

  open_notebook:
    image: lfnovo/open_notebook:v1-latest
    container_name: open-notebook
    pull_policy: always
    env_file:
      - /mnt/sdcard/open-notebook/.env
    environment:
      - API_URL=https://notebook-api.internal.keepdream.in
    ports:
      - "8502:8502"  # Web UI
      - "5055:5055"  # API
    volumes:
      - /mnt/sdcard/open-notebook/notebook_data:/app/data
    networks:
      - proxy-network
    depends_on:
      surrealdb:
        condition: service_started
      sdcard-mount:
        condition: service_healthy
    restart: unless-stopped

networks:
  proxy-network:
    external: true

